{
  // ==========================================================================
  // Java Dev Container Template
  // ==========================================================================
  // Generated from template options. Customize as needed.
  //
  // See: https://containers.dev/implementors/json_reference/
  // ==========================================================================

  "name": "Java Development",

  // --------------------------------------------------------------------------
  // Image Configuration
  // --------------------------------------------------------------------------
  // Option 1: Use pre-built image (faster startup, recommended for teams)
  "image": "mcr.microsoft.com/devcontainers/base:ubuntu",

  // Option 2: Build from Dockerfile in this directory
  // "build": {
  //   "dockerfile": "Dockerfile",
  //   "context": ".."
  // },

  // --------------------------------------------------------------------------
  // Host Requirements (for cloud-hosted dev environments)
  // --------------------------------------------------------------------------
  "hostRequirements": {
    "cpus": 4,
    "memory": "8gb",
    "storage": "32gb"
  },

  // --------------------------------------------------------------------------
  // Features - Add pre-packaged tools
  // --------------------------------------------------------------------------
  // Custom features: https://github.com/jasonchaffee/devcontainers
  // Official features: https://containers.dev/features
  "features": {
    // =========================================================================
    // Official Features
    // =========================================================================
    "ghcr.io/devcontainers/features/common-utils:2": {
      "username": "vscode",
      "installZsh": true,
      "configureZshAsDefaultShell": true
    },
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/devcontainers/features/python:1": {},
    "ghcr.io/devcontainers/features/java:1": {
      "version": "${templateOption:javaVersion}",
      "jdkDistro": "${templateOption:jdkDistro}",
      "installMaven": "${templateOption:installMaven}",
      "installGradle": "${templateOption:installGradle}"
    },
    "ghcr.io/devcontainers/features/node:1": {},
    "ghcr.io/devcontainers/features/docker-outside-of-docker:1": {},
    "ghcr.io/devcontainers/features/kubectl-helm-minikube:1": {
      "minikube": "none"
    },

    // =========================================================================
    // Custom Features
    // =========================================================================
    "ghcr.io/jasonchaffee/devcontainers/antidote:1": {},
    "ghcr.io/jasonchaffee/devcontainers/modern-cli:1": {},
    "ghcr.io/jasonchaffee/devcontainers/shell-dev:1": {},
    "ghcr.io/jasonchaffee/devcontainers/http-tools:1": {},
    "ghcr.io/jasonchaffee/devcontainers/terminal-extras:1": {},

    // AI Tools
    "ghcr.io/jasonchaffee/devcontainers/claude-code:1": {
      "version": "${templateOption:claudeCodeVersion}",
      "installStatusLine": "${templateOption:claudeCodeStatusLine}"
    },
    "ghcr.io/jasonchaffee/devcontainers/codex:1": {
      "version": "${templateOption:codexVersion}"
    },
    "ghcr.io/jasonchaffee/devcontainers/gemini-cli:1": {
      "version": "${templateOption:geminiVersion}"
    },

    // Performance Testing
    "ghcr.io/grafana/devcontainer-features/k6:1": {},
    "ghcr.io/jasonchaffee/devcontainers/locust:1": {},

    // Google Cloud CLI
    "ghcr.io/jasonchaffee/devcontainers/gcloud-cli:1": {
      "version": "${templateOption:gcloudVersion}",
      "installCrc32c": "${templateOption:gcloudInstallCrc32c}",
      "installGkeGcloudAuthPlugin": "${templateOption:gcloudInstallGkeGcloudAuthPlugin}",
      "installSkaffold": "${templateOption:gcloudInstallSkaffold}",
      "installKubectl": "${templateOption:gcloudInstallKubectl}",
      "installBeta": "${templateOption:gcloudInstallBeta}",
      "installEmulators": "${templateOption:gcloudInstallEmulators}",
      "installAppEngineJava": "${templateOption:gcloudInstallAppEngineJava}",
      "installComponents": "${templateOption:gcloudInstallComponents}"
    },

    // =========================================================================
    // JetBrains (installJetBrains: true)
    // =========================================================================
    "ghcr.io/jasonchaffee/devcontainers/jetbrains:1": {}

    // =========================================================================
    // Optional: Spring Boot (installSpring: false)
    // =========================================================================
    // "ghcr.io/jasonchaffee/devcontainers/spring:1": {}

    // =========================================================================
    // Optional: JMeter (installJmeter: false)
    // =========================================================================
    // "ghcr.io/jasonchaffee/devcontainers/jmeter:1": {}

    // =========================================================================
    // Optional: Terraform (installTerraform: false)
    // =========================================================================
    // "ghcr.io/devcontainers/features/terraform:1": {}

    // =========================================================================
    // Optional: Homebrew (installHomebrew: false)
    // =========================================================================
    // "ghcr.io/meaningful-ooo/devcontainer-features/homebrew:2": {}

    // =========================================================================
    // Optional: GitHub Copilot CLI (installCopilot: false)
    // =========================================================================
    // "ghcr.io/devcontainers/features/copilot-cli:1": {}
  },

  // --------------------------------------------------------------------------
  // IDE Customizations
  // --------------------------------------------------------------------------
  "customizations": {
    // VS Code and Cursor
    "vscode": {
      "extensions": [
        // Java development
        "vscjava.vscode-java-pack",
        "vscjava.vscode-gradle",
        "vscjava.vscode-maven",
        "redhat.java",

        // Python
        "ms-python.python",
        "charliermarsh.ruff",

        // Git
        "eamodio.gitlens",
        "mhutchie.git-graph",
        "donjayamanne.githistory",
        "github.vscode-pull-request-github",

        // Code quality
        "esbenp.prettier-vscode",
        "dbaeumer.vscode-eslint",
        "usernamehw.errorlens",
        "streetsidesoftware.code-spell-checker",

        // Infrastructure
        "hashicorp.terraform",
        "redhat.vscode-yaml",
        "ms-azuretools.vscode-docker",

        // Utilities
        "gruntfuggly.todo-tree",
        "alefragnani.project-manager",
        "xyz.local-history",
        "github.vscode-github-actions",

        // AI Tools
        "anthropic.claude-code",
        "github.copilot",
        "google.geminicodeassist"
      ],
      "settings": {
        "java.configuration.updateBuildConfiguration": "automatic",
        "editor.formatOnSave": true,
        "terminal.integrated.defaultProfile.linux": "zsh",
        "remote.autoForwardPorts": false
      }
    },
    // JetBrains (IntelliJ IDEA, etc.)
    // Note: Requires jetbrains feature for system dependencies
    // Plugin IDs from: https://plugins.jetbrains.com/
    "jetbrains": {
      "plugins": [
        "com.intellij.spring",
        "org.sonarlint.idea",
        "org.jetbrains.plugins.github",
        "Docker",
        "org.jetbrains.kotlin",
        "org.jetbrains.plugins.yaml",
        "org.toml.lang",
        "org.intellij.plugins.hcl",
        "Lombook Plugin",
        "GrepConsole",
        "com.github.copilot",
        "com.google.idea.geminicodeassist",
        "com.anthropic.code.plugin",
        "com.jetbrains.junie",
        "google-java-format"
      ]
    }
  },

  // --------------------------------------------------------------------------
  // Environment Variables
  // --------------------------------------------------------------------------
  // IMPORTANT: ${localEnv:VAR} reads from the IDE process environment.
  // IDEs launched from Dock/Spotlight won't have shell env vars.
  // Set tokens in ~/.zshenv or use launchctl setenv for reliable forwarding.
  "remoteEnv": {
    // =========================================================================
    // AI Tools
    // =========================================================================
    // Claude Code
    "ANTHROPIC_BASE_URL": "${localEnv:ANTHROPIC_BASE_URL}",
    "ANTHROPIC_AUTH_TOKEN": "${localEnv:ANTHROPIC_AUTH_TOKEN}",
    "ANTHROPIC_API_KEY": "${localEnv:ANTHROPIC_API_KEY}",
    "DISABLE_AUTOUPDATER": "${localEnv:DISABLE_AUTOUPDATER}",
    "CLAUDE_CODE_DISABLE_EXPERIMENTAL_BETAS": "${localEnv:CLAUDE_CODE_DISABLE_EXPERIMENTAL_BETAS}",

    // Gemini CLI
    "GOOGLE_API_KEY": "${localEnv:GOOGLE_API_KEY}",
    "GOOGLE_CLOUD_PROJECT": "${localEnv:GOOGLE_CLOUD_PROJECT}",

    // GitHub token for gh CLI and Copilot
    "GITHUB_TOKEN": "${localEnv:GITHUB_TOKEN}"
  },

  // --------------------------------------------------------------------------
  // Port Forwarding
  // --------------------------------------------------------------------------
  "forwardPorts": [
    8080,
    5005
  ],

  "portsAttributes": {
    "8080": {
      "label": "Spring Boot",
      "onAutoForward": "notify"
    },
    "5005": {
      "label": "Java Debug",
      "onAutoForward": "silent"
    }
  },

  // --------------------------------------------------------------------------
  // Mounts - Bind host files/directories into container
  // --------------------------------------------------------------------------
  // IMPORTANT: Bind mounts FAIL if source doesn't exist!
  // - Directories: Docker creates empty dir on host (owned by root)
  // - Files: Container fails to start
  //
  // Review the OPTIONAL section below and REMOVE any mounts for files you
  // don't have on your system.
  // --------------------------------------------------------------------------
  "mounts": [
    // =========================================================================
    // REQUIRED - Most devs have these
    // =========================================================================

    // Git (needed for commits and push/pull)
    "source=${localEnv:HOME}/.gitconfig,target=/home/vscode/.gitconfig,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.ssh,target=/home/vscode/.ssh,type=bind,consistency=cached",

    // Maven cache (speeds up builds significantly)
    "source=${localEnv:HOME}/.m2,target=/home/vscode/.m2,type=bind,consistency=cached",

    // Named volumes (always work, no host file needed)
    "source=${localWorkspaceFolderBasename}-target,target=/workspace/target,type=volume",
    "source=${localWorkspaceFolderBasename}-shellhistory,target=/commandhistory,type=volume",

    // =========================================================================
    // RECOMMENDED - Remove if you don't have these directories
    // =========================================================================

    // AI Tools - remove lines for tools you don't use
    "source=${localEnv:HOME}/.claude,target=/home/vscode/.claude,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.claude.json,target=/home/vscode/.claude.json,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.codex,target=/home/vscode/.codex,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.gemini,target=/home/vscode/.gemini,type=bind,consistency=cached",

    "source=${localEnv:HOME}/.config/gh,target=/home/vscode/.config/gh,type=bind,consistency=cached",

    // Cloud credentials
    "source=${localEnv:HOME}/.config/gcloud,target=/home/vscode/.config/gcloud,type=bind,consistency=cached",

    // Kubernetes — read-only mount to staging path; post-start.sh copies to
    // ~/.kube and rewrites 127.0.0.1 → host.docker.internal for devcontainer
    "source=${localEnv:HOME}/.kube,target=/home/vscode/.kube-host,type=bind,consistency=cached,readonly",

    // Gradle cache
    //"source=${localEnv:HOME}/.gradle,target=/home/vscode/.gradle,type=bind,consistency=cached",

    // =========================================================================
    // OPTIONAL - Remove if files don't exist on your system
    // =========================================================================

    // Cursor IDE settings
    "source=${localEnv:HOME}/.cursor,target=/home/vscode/.cursor,type=bind,consistency=cached",

    // Zsh configuration - uncomment what you have
    "source=${localEnv:HOME}/.zshrc,target=/home/vscode/.zshrc,type=bind,consistency=cached",
    // "source=${localEnv:HOME}/.zshenv,target=/home/vscode/.zshenv,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.zprofile,target=/home/vscode/.zprofile,type=bind,consistency=cached",
    // "source=${localEnv:HOME}/.zsh,target=/home/vscode/.zsh,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.zsh_plugins.txt,target=/home/vscode/.zsh_plugins.txt,type=bind,consistency=cached",

    // Vim configuration
    "source=${localEnv:HOME}/.vimrc,target=/home/vscode/.vimrc,type=bind,consistency=cached"
    // "source=${localEnv:HOME}/.vim,target=/home/vscode/.vim,type=bind,consistency=cached"
  ],

  // --------------------------------------------------------------------------
  // Lifecycle Commands
  // --------------------------------------------------------------------------
  // Runs on host BEFORE container starts - create directories to avoid root ownership issues
  "initializeCommand": "mkdir -p ~/.m2 ~/.kube ~/.claude ~/.codex ~/.gemini ~/.config/gcloud ~/.config/gh ~/.gradle",

  // Runs ONCE after container creation
  "postCreateCommand": ".devcontainer/post-create.sh",

  // Runs EVERY time container starts
  "postStartCommand": ".devcontainer/post-start.sh",

  "remoteUser": "vscode"
}
